<!DOCTYPE html>
<html lang="en">
  <head>
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <link rel="shortcut icon" type="image/x-icon" href="favicon.ico" />

    <title>system-test</title>

    <meta charset="utf-8" />
    <link href="http://ioos.github.io/system-test//feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="system-test Full Atom Feed" />
    <link href="http://ioos.github.io/system-test//atom.xml" type="application/atom+xml" rel="alternate" title="system-test Atom Feed" />
    <link href="http://ioos.github.io/system-test//feeds/misc.atom.xml" type="application/atom+xml" rel="alternate" title="system-test Categories Atom Feed" />
    <link rel="stylesheet" href="/theme/css/poole.css"/>
    <link rel="stylesheet" href="/theme/css/syntax.css"/>
    <link rel="stylesheet" href="/theme/css/lanyon.css"/>
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=PT+Serif:400,400italic,700%7CPT+Sans:400">
    <link rel="stylesheet" href="/theme/css/styles.css"/>




  </head>

  <body>
<!-- Target for toggling the sidebar `.sidebar-checkbox` is for regular
styles, `#sidebar-checkbox` for behavior. -->
<input type="checkbox" class="sidebar-checkbox" id="sidebar-checkbox">
<!-- Toggleable sidebar -->
<div class="sidebar" id="sidebar">
  <div class="sidebar-item">
    <div class="profile">
      <img src="/theme/img/profile.png"/>
    </div>
  </div>

  <nav class="sidebar-nav">
  <a class="sidebar-nav-item" href="/">All</a>

      <a class="sidebar-nav-item" href="/category/misc.html">misc</a>

  <a class="sidebar-nav-item" href="http://www.noaa.gov/">NOAA</a>
  <a class="sidebar-nav-item" href="http://www.ioos.noaa.gov/">IOOS</a>
  </nav>

  <div class="sidebar-item">
    <p>
    <a href="https://twitter.com/">&copy; @</a> 2015
    </p>
    <p class="tiny-note">
      <a class="muted" href="https://github.com/thomaswilley/pelicanyan">pelicanyan v0.1</a>
    </p>
  </div>
</div>    <div class="wrap">
      <div class="masthead">
        <div class="container">
          <h3 class="masthead-title">
            <a href="/" title="Home">system-test</a>
          </h3>
        </div>
      </div>

      <div class="container content">
<div class="posts">
<div class="post">
    <h1 class="post-title">
      Catalog based search for the IOOS Regional Associations using UUID
    </h1>
    <span class="post-date">Dec 07, 2015</span>

    <p>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In the <a href="https://ioos.github.io/system-test/blog/2015/11/23/NGDC_CSW_QueryForIOOSRAs/">previous example</a> we investigated if it was possible to query the NGDC CSW Catalog to extract records matching an IOOS RA acronym.
However, we could not trust the results.
Some RAs results in just a few records or no record at all, like AOOS and PacIOOS respectively.</p>
<p>We can make a more robust search using the <a href="https://en.wikipedia.org/wiki/Universally_unique_identifier">UUID</a> rather than the acronym.
The advantage is that all records will be associated to an UUID,
hence a more robust search.
The disadvantage is that we need to keep track of a long and unintelligible identification.</p>
<p>As usual let&#39;s start by instantiating the csw catalog object.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight-ipynb"><pre class="ipynb"><span class="kn">from</span> <span class="nn">owslib.csw</span> <span class="kn">import</span> <span class="n">CatalogueServiceWeb</span>

<span class="n">endpoint</span> <span class="o">=</span> <span class="s">&#39;http://www.ngdc.noaa.gov/geoportal/csw&#39;</span>
<span class="n">csw</span> <span class="o">=</span> <span class="n">CatalogueServiceWeb</span><span class="p">(</span><span class="n">endpoint</span><span class="p">,</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We will use the same list of all the Regional Associations as before,
but now we will match them with the corresponding UUID from the <a href="https://github.com/ioos/registry/blob/master/uuid.csv">IOOS registry</a>.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight-ipynb"><pre class="ipynb"><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="n">ioos_ras</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;AOOS&#39;</span><span class="p">,</span>      <span class="c"># Alaska</span>
            <span class="s">&#39;CaRA&#39;</span><span class="p">,</span>      <span class="c"># Caribbean</span>
            <span class="s">&#39;CeNCOOS&#39;</span><span class="p">,</span>   <span class="c"># Central and Northern California</span>
            <span class="s">&#39;GCOOS&#39;</span><span class="p">,</span>     <span class="c"># Gulf of Mexico</span>
            <span class="s">&#39;GLOS&#39;</span><span class="p">,</span>      <span class="c"># Great Lakes</span>
            <span class="s">&#39;MARACOOS&#39;</span><span class="p">,</span>  <span class="c"># Mid-Atlantic</span>
            <span class="s">&#39;NANOOS&#39;</span><span class="p">,</span>    <span class="c"># Pacific Northwest </span>
            <span class="s">&#39;NERACOOS&#39;</span><span class="p">,</span>  <span class="c"># Northeast Atlantic </span>
            <span class="s">&#39;PacIOOS&#39;</span><span class="p">,</span>   <span class="c"># Pacific Islands </span>
            <span class="s">&#39;SCCOOS&#39;</span><span class="p">,</span>    <span class="c"># Southern California</span>
            <span class="s">&#39;SECOORA&#39;</span><span class="p">]</span>   <span class="c"># Southeast Atlantic</span>

<span class="n">url</span> <span class="o">=</span> <span class="s">&#39;https://raw.githubusercontent.com/ioos/registry/master/uuid.csv&#39;</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s">&#39;UUID&#39;</span><span class="p">])</span>
<span class="n">df</span><span class="p">[</span><span class="s">&#39;UUID&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">&#39;UUID&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</pre></div>

</div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The function below is similar to the one we used before.
Note the same matching (<code>PropertyIsEqualTo</code>),
but different property name (<code>sys.siteuuid</code> rather than <code>apiso:Keywords</code>).</p>
<p>That is the key difference for the robustness of the search,
keywords are not always defined and might return bogus matching.
While UUID will always mean one RA.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight-ipynb"><pre class="ipynb"><span class="kn">from</span> <span class="nn">owslib.fes</span> <span class="kn">import</span> <span class="n">PropertyIsEqualTo</span>

<span class="k">def</span> <span class="nf">query_ra</span><span class="p">(</span><span class="n">csw</span><span class="p">,</span> <span class="n">uuid</span><span class="p">):</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">PropertyIsEqualTo</span><span class="p">(</span><span class="n">propertyname</span><span class="o">=</span><span class="s">&#39;sys.siteuuid&#39;</span><span class="p">,</span> <span class="n">literal</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">uuid</span><span class="p">)</span>
    <span class="n">csw</span><span class="o">.</span><span class="n">getrecords2</span><span class="p">(</span><span class="n">constraints</span><span class="o">=</span><span class="p">[</span><span class="n">q</span><span class="p">],</span> <span class="n">maxrecords</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">esn</span><span class="o">=</span><span class="s">&#39;full&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">csw</span>
</pre></div>

</div>
</div>
</div>

</div>
                Here is what we got:
                
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight-ipynb"><pre class="ipynb"><span class="k">for</span> <span class="n">ra</span> <span class="ow">in</span> <span class="n">ioos_ras</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">uuid</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">ix</span><span class="p">[</span><span class="n">ra</span><span class="p">][</span><span class="s">&#39;UUID&#39;</span><span class="p">]</span>
        <span class="n">csw</span> <span class="o">=</span> <span class="n">query_ra</span><span class="p">(</span><span class="n">csw</span><span class="p">,</span> <span class="n">uuid</span><span class="p">)</span>
        <span class="n">ret</span> <span class="o">=</span> <span class="n">csw</span><span class="o">.</span><span class="n">results</span><span class="p">[</span><span class="s">&#39;returned&#39;</span><span class="p">]</span>
        <span class="n">word</span> <span class="o">=</span> <span class="s">&#39;records&#39;</span> <span class="k">if</span> <span class="n">ret</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="s">&#39;record&#39;</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;{0:&gt;8} has {1:&gt;4} {2}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ra</span><span class="p">,</span> <span class="n">ret</span><span class="p">,</span> <span class="n">word</span><span class="p">))</span>
        <span class="n">csw</span><span class="o">.</span><span class="n">records</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="k">pass</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt"></div>
<div class="output_subarea output_stream output_stdout output_text">
<pre>
    AOOS has   74 records
   GCOOS has    8 records
    GLOS has   20 records
MARACOOS has  468 records
  NANOOS has    8 records
NERACOOS has 1109 records
 PacIOOS has  192 records
  SCCOOS has   23 records
 SECOORA has  100 records

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="prompt input_prompt">
</div>
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Compare the results above with <code>cell [6]</code> <a href="https://ioos.github.io/system-test/blog/2015/11/23/NGDC_CSW_QueryForIOOSRAs/">from before</a>.  Note that now we got 192 for PacIOOS and 74 for AOOS now!</p>
<p>You can see the original notebook <a href="https://www.wakari.io/sharing/bundle/emayorga/NGDC_CSW_QueryForIOOSRAs_UUID">here</a>.</p>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class="highlight-ipynb"><pre class="ipynb"><span class="n">HTML</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area"><div class="prompt output_prompt">Out[7]:</div>

<div class="output_html rendered_html output_subarea output_pyout">

<small>
<p> This post was written as an IPython notebook.  It is available for
<a href="http://ioos.github.com/system-test/downloads/
notebooks/2015-12-07-NGDC_CSW_QueryForIOOSRAs_UUID.ipynb">download</a>.  You can also try an interactive version on
<a href="http://mybinder.org/repo/ioos/system-test/">binder</a>.</p>
<p></p>

</div>

</div>

</div>
</div>

</div></p>
  </div>
</div>
      </div>

      <label for="sidebar-checkbox" class="sidebar-toggle"></label>

      <script>
        (function(document) {
          var i = 0;
          // snip empty header rows since markdown can't
          var rows = document.querySelectorAll('tr');
          for(i=0; i<rows.length; i++) {
            var ths = rows[i].querySelectorAll('th');
            var rowlen = rows[i].children.length;
            if (ths.length > 0 && ths.length === rowlen) {
              rows[i].remove();
            }
          }
        })(document);
      </script>

      <script>
        /* Lanyon & Poole are Copyright (c) 2014 Mark Otto. Adapted to Pelican 20141223 and extended a bit by @thomaswilley */
        (function(document) {
          var toggle = document.querySelector('.sidebar-toggle');
          var sidebar = document.querySelector('#sidebar');
          var checkbox = document.querySelector('#sidebar-checkbox');
          document.addEventListener('click', function(e) {
            var target = e.target;
            if(!checkbox.checked ||
            sidebar.contains(target) ||
            (target === checkbox || target === toggle)) return;
            checkbox.checked = false;
            }, false);
            })(document);
      </script>
     </div>
  </body>
</html>